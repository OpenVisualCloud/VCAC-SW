From 7a002c78f5e2eb824815701cc65fb44df49b71aa Mon Sep 17 00:00:00 2001
From: Artur Opalinski <ArturX.Opalinski@intel.com>
Date: Wed, 10 Jun 2020 10:05:05 +0000
Subject: [PATCH 5/7] Building VOP, VOP_BUS as modules

Current methd of building&booting images requires this
---
 .config | 15 ++++++++++++++-
 1 file changed, 14 insertions(+), 1 deletion(-)

diff --git a/.config b/.config
index e6bdcaf3d18f..97543d5f635e 100644
--- a/.config
+++ b/.config
@@ -755,6 +755,7 @@ CONFIG_EFI_PARTITION=y
 
 CONFIG_BLOCK_COMPAT=y
 CONFIG_BLK_MQ_PCI=y
+CONFIG_BLK_MQ_VIRTIO=y
 CONFIG_BLK_PM=y
 
 #
@@ -1358,6 +1359,7 @@ CONFIG_BLK_DEV_LOOP_MIN_COUNT=8
 # CONFIG_BLK_DEV_RAM is not set
 # CONFIG_CDROM_PKTCDVD is not set
 # CONFIG_ATA_OVER_ETH is not set
+# CONFIG_VIRTIO_BLK is not set
 # CONFIG_BLK_DEV_RBD is not set
 # CONFIG_BLK_DEV_RSXX is not set
 
@@ -1437,7 +1439,7 @@ CONFIG_BLK_DEV_LOOP_MIN_COUNT=8
 #
 # VOP Bus Driver
 #
-# CONFIG_VOP_BUS is not set
+CONFIG_VOP_BUS=m
 
 #
 # Intel MIC Host Driver
@@ -1458,6 +1460,8 @@ CONFIG_BLK_DEV_LOOP_MIN_COUNT=8
 #
 # VOP Driver
 #
+CONFIG_VOP=m
+CONFIG_VHOST_RING=m
 # end of Intel MIC & related support
 
 # CONFIG_GENWQE is not set
@@ -1669,6 +1673,7 @@ CONFIG_NET_POLL_CONTROLLER=y
 # CONFIG_TUN is not set
 # CONFIG_TUN_VNET_CROSS_LE is not set
 # CONFIG_VETH is not set
+# CONFIG_VIRTIO_NET is not set
 # CONFIG_NLMON is not set
 # CONFIG_ARCNET is not set
 
@@ -2319,12 +2324,14 @@ CONFIG_SERIAL_CORE_CONSOLE=y
 # end of Serial drivers
 
 # CONFIG_SERIAL_DEV_BUS is not set
+# CONFIG_VIRTIO_CONSOLE is not set
 # CONFIG_IPMI_HANDLER is not set
 CONFIG_HW_RANDOM=y
 # CONFIG_HW_RANDOM_TIMERIOMEM is not set
 # CONFIG_HW_RANDOM_INTEL is not set
 # CONFIG_HW_RANDOM_AMD is not set
 CONFIG_HW_RANDOM_VIA=y
+# CONFIG_HW_RANDOM_VIRTIO is not set
 CONFIG_NVRAM=y
 # CONFIG_APPLICOM is not set
 
@@ -2873,6 +2880,7 @@ CONFIG_DRM_I915_SPIN_REQUEST=5
 # CONFIG_DRM_CIRRUS_QEMU is not set
 # CONFIG_DRM_QXL is not set
 # CONFIG_DRM_BOCHS is not set
+# CONFIG_DRM_VIRTIO_GPU is not set
 CONFIG_DRM_PANEL=y
 
 #
@@ -3677,8 +3685,11 @@ CONFIG_SYNC_FILE=y
 # CONFIG_UIO is not set
 # CONFIG_VFIO is not set
 # CONFIG_VIRT_DRIVERS is not set
+CONFIG_VIRTIO=m
 CONFIG_VIRTIO_MENU=y
 # CONFIG_VIRTIO_PCI is not set
+# CONFIG_VIRTIO_BALLOON is not set
+# CONFIG_VIRTIO_INPUT is not set
 # CONFIG_VIRTIO_MMIO is not set
 
 #
@@ -4213,6 +4224,7 @@ CONFIG_CRYPTO_NULL2=y
 # CONFIG_CRYPTO_CRYPTD is not set
 CONFIG_CRYPTO_AUTHENC=y
 # CONFIG_CRYPTO_TEST is not set
+CONFIG_CRYPTO_ENGINE=m
 
 #
 # Public-key cryptography
@@ -4375,6 +4387,7 @@ CONFIG_CRYPTO_HW=y
 # CONFIG_CRYPTO_DEV_QAT_C3XXXVF is not set
 # CONFIG_CRYPTO_DEV_QAT_C62XVF is not set
 # CONFIG_CRYPTO_DEV_NITROX_CNN55XX is not set
+CONFIG_CRYPTO_DEV_VIRTIO=m
 CONFIG_ASYMMETRIC_KEY_TYPE=y
 CONFIG_ASYMMETRIC_PUBLIC_KEY_SUBTYPE=y
 CONFIG_X509_CERTIFICATE_PARSER=y
-- 
2.17.1

